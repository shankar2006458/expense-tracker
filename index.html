<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Expense Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom Animations */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .fade-in-up {
      animation: fadeInUp 0.7s cubic-bezier(.4,0,.2,1) both;
    }

    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg);}
      50% { transform: rotate(3deg);}
    }
    .wiggle {
      animation: wiggle 0.5s ease-in-out;
    }

    /* Card hover effect */
    .card-hover:hover {
      box-shadow: 0 8px 32px 0 rgba(60,130,246,0.15);
      transform: scale(1.04);
      transition: all 0.3s;
    }

    /* Button glow effect */
    .glow-btn {
      box-shadow: 0 0 8px 2px #2563eb;
      transition: box-shadow 0.3s;
    }
    .glow-btn:hover {
      box-shadow: 0 0 16px 4px #1e40af;
    }

    /* Full dark theme */
    body, .bg-white, .bg-gray-100, .bg-blue-600, .bg-blue-900, .bg-gray-800 {
      background-color: #18181b !important;
      color: #f4f4f5 !important;
      transition: none !important;
    }
    .bg-white, .bg-gray-100, .bg-blue-600, .bg-blue-900, .bg-gray-800 {
      background-color: #23232a !important;
    }
    .text-gray-800, .text-gray-500, .text-gray-400 {
      color: #f4f4f5 !important;
    }
    .bg-gray-200 {
      background-color: #27272a !important;
    }
    .border {
      border-color: #3f3f46 !important;
    }
    input, select, textarea {
      background-color: #18181b !important;
      color: #f4f4f5 !important;
      border-color: #3f3f46 !important;
    }
    table {
      color: #f4f4f5 !important;
    }
    .shadow {
      box-shadow: 0 2px 8px 0 rgba(30,41,59,0.25);
    }
    .hover\:bg-blue-100:hover {
      background-color: #27272a !important;
    }
    .text-blue-500 { color: #60a5fa !important; }
    .text-red-500 { color: #f87171 !important; }
    .bg-blue-600 { background-color: #2563eb !important; }
    .hover\:bg-gray-600:hover { background-color: #3f3f46 !important; }
    .bg-yellow-100 { background-color: #facc15 !important; color: #18181b !important; }
    .animate-bounce { color: #f87171 !important; }
  </style>
</head>

<body class="bg-gray-900 text-gray-100">
  <!-- Remove Dark Mode Toggle & Budget Input above main -->
  <header class="bg-blue-600 text-white p-4 text-center text-2xl font-bold flex justify-between items-center">
    <span>Personal Expense Tracker</span>
    <div class="flex items-center gap-2">
      <span class="text-sm text-gray-500">Expected Monthly Budget</span>
      <input type="number" id="budget" placeholder="Set Monthly Budget" class="border p-2 rounded text-white bg-gray-800" style="width:140px;" readonly>
      <button id="edit-budget" class="bg-yellow-500 text-black px-3 py-1 rounded hover:bg-yellow-400">Edit</button>
      <button id="save-budget" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-400 hidden">Save</button>
    </div>
  </header>

  <main class="max-w-4xl mx-auto p-4">

    <!-- Add Expense Form -->
    <section class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-xl font-bold mb-2">Add New Expense</h2>
      <form id="expense-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="number" id="amount" placeholder="Amount" required class="border p-2 rounded">
        <select id="category" required class="border p-2 rounded">
          <option value="" disabled selected>Select Category</option>
          <option>Food</option>
          <option>Transport</option>
          <option>Petrol</option>
          <option>Shopping</option>
          <option>Groceries</option>
          <option>Health & Medical</option>
          <option>Entertainment</option>
          <option>Travel</option>
          <option>Gifts & Donations</option>
          <option>Personal Care</option>
          <option>Kids</option>
          <option>Fees</option>
          <option>Other</option>
        </select>
        <input type="date" id="date" required class="border p-2 rounded">
        <input type="text" id="description" placeholder="Description" class="border p-2 rounded">
        <div class="col-span-1 md:col-span-2 flex gap-2">
          <button type="submit" class="bg-blue-600 text-white p-2 rounded flex-1">Add Expense</button>
          <button type="button" id="cancel-edit" class="bg-gray-500 text-white p-2 rounded flex-1 hidden">Cancel</button>
        </div>
      </form>
      <!-- Toast notification -->
      <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded shadow-lg z-50 hidden"></div>
    </section>

    <!-- Summary Cards -->
    <section class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">
      <div class="bg-white p-4 rounded shadow text-center">
        <p class="text-gray-500">Today</p>
        <h3 id="today-total" class="text-2xl font-bold">₹0</h3>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <p class="text-gray-500">This Week</p>
        <h3 id="week-total" class="text-2xl font-bold">₹0</h3>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <p class="text-gray-500">This Month</p>
        <h3 id="month-total" class="text-2xl font-bold">₹0</h3>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <p class="text-gray-500">This Year</p>
        <h3 id="year-total" class="text-2xl font-bold">₹0</h3>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <p class="text-gray-500">Custom Range</p>
        <h3 id="custom-total" class="text-2xl font-bold">₹0</h3>
      </div>
    </section>

    <!-- Expense List -->
    <section class="bg-white p-4 rounded shadow mb-4">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-xl font-bold">Expenses</h2>
        <input type="text" id="search" placeholder="Search..."
          class="border p-2 rounded w-1/3 transition duration-300 focus:ring focus:ring-blue-300">
      </div>
      <table class="w-full border transition-all duration-500">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Amount</th>
            <th class="border p-2">Category</th>
            <th class="border p-2">Date</th>
            <th class="border p-2">Description</th>
            <th class="border p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="expense-list">
          <!-- Expenses will appear here -->
        </tbody>
      </table>
      <div id="budget-alert"
        class="mt-2 text-center text-red-600 font-bold hidden animate-bounce"></div>
    </section>

    <!-- Analytics Charts -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-bold mb-2">Category-wise Breakdown</h2>
        <canvas id="category-chart"></canvas>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-bold mb-2">Monthly Spending Trends</h2>
        <canvas id="monthly-chart"></canvas>
      </div>
    </section>
  </main>

  <footer class="text-center text-gray-500 py-4">
    &copy; Developed By ~ Shankar Prasad Pyke.
  </footer>

  <script>
    const expenseForm = document.getElementById('expense-form');
    const expenseList = document.getElementById('expense-list');
    const weekTotal = document.getElementById('week-total');
    const monthTotal = document.getElementById('month-total');
    const yearTotal = document.getElementById('year-total');
    const customTotal = document.getElementById('custom-total');
    const todayTotal = document.getElementById('today-total');

    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    let editingIndex = null;
    let budget = localStorage.getItem('budget') ? +localStorage.getItem('budget') : 0;
    document.getElementById('budget').value = budget || '';

    const budgetInput = document.getElementById('budget');
    const editBtn = document.getElementById('edit-budget');
    const saveBtn = document.getElementById('save-budget');

    // Edit budget
    editBtn.addEventListener('click', () => {
      budgetInput.removeAttribute('readonly');
      budgetInput.focus();
      editBtn.classList.add('hidden');
      saveBtn.classList.remove('hidden');
    });

    // Save budget
    saveBtn.addEventListener('click', () => {
      budget = +budgetInput.value;
      localStorage.setItem('budget', budget);
      updateSummary();
      budgetInput.setAttribute('readonly', true);
      saveBtn.classList.add('hidden');
      editBtn.classList.remove('hidden');
    });

    // Optional: Save on Enter key
    budgetInput.addEventListener('keydown', (e) => {
      if (!budgetInput.hasAttribute('readonly') && e.key === 'Enter') {
        saveBtn.click();
      }
    });

    // Budget input
    document.getElementById('budget').addEventListener('change', e => {
      budget = +e.target.value;
      localStorage.setItem('budget', budget);
      updateSummary();
    });

    // Search feature
    document.getElementById('search').addEventListener('input', renderExpenses);

    function saveExpenses() {
      localStorage.setItem('expenses', JSON.stringify(expenses));
    }

    function renderExpenses() {
      const search = document.getElementById('search').value.toLowerCase();
      expenseList.innerHTML = '';
      // Sort by date descending (most recent first)
      const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));

      // Month name mapping
      const monthNames = [
        "january", "february", "march", "april", "may", "june",
        "july", "august", "september", "october", "november", "december"
      ];
      let searchMonthIndex = -1;
      if (search) {
        searchMonthIndex = monthNames.findIndex(m => search.includes(m));
      }

      sortedExpenses.forEach((expense, index) => {
        // Find the original index for edit/delete
        const origIndex = expenses.indexOf(expense);

        // Check if search is a month name and filter by month
        let matches = false;
        if (searchMonthIndex !== -1) {
          const expDate = new Date(expense.date);
          matches = expDate.getMonth() === searchMonthIndex;
        } else {
          matches =
            expense.category.toLowerCase().includes(search) ||
            expense.description.toLowerCase().includes(search) ||
            expense.amount.toString().includes(search) ||
            expense.date.includes(search);
        }

        if (matches) {
          expenseList.innerHTML += `
            <tr class="transition duration-300 hover:bg-blue-100 ${editingIndex === origIndex ? 'animate-pulse bg-yellow-100' : ''}">
              <td class="border p-2">₹${expense.amount}</td>
              <td class="border p-2">${expense.category}</td>
              <td class="border p-2">${formatDate(expense.date)}</td>
              <td class="border p-2">${expense.description}</td>
              <td class="border p-2 flex gap-2">
                <button onclick="editExpense(${origIndex})" class="text-blue-500 hover:underline">Edit</button>
                <button onclick="deleteExpense(${origIndex})" class="text-red-500 hover:underline">Delete</button>
              </td>
            </tr>
          `;
        }
      });
      updateSummary();
      updateCharts();
    }

    // Edit feature
    window.editExpense = function(index) {
      editingIndex = index;
      const expense = expenses[index];
      document.getElementById('amount').value = expense.amount;
      document.getElementById('category').value = expense.category;
      document.getElementById('date').value = expense.date;
      document.getElementById('description').value = expense.description;
      expenseForm.querySelector('button[type="submit"]').textContent = "Update Expense";
      cancelEditBtn.classList.remove('hidden');
    };

    // Cancel Edit functionality
    const cancelEditBtn = document.getElementById('cancel-edit');

    cancelEditBtn.addEventListener('click', () => {
      editingIndex = null;
      expenseForm.reset();
      expenseForm.querySelector('button[type="submit"]').textContent = "Add Expense";
      cancelEditBtn.classList.add('hidden');
      // Reset max date after reset
      dateInput.setAttribute('max', todayStr);
    });

    // Set max date for date input to today
    const dateInput = document.getElementById('date');
    const todayStr = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('max', todayStr);

    // Toast utility
    function showToast(message, duration = 2500) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => {
        toast.classList.add('hidden');
      }, duration);
    }

    expenseForm.addEventListener('submit', e => {
      e.preventDefault();
      const amount = +document.getElementById('amount').value;
      const category = document.getElementById('category').value;
      const date = document.getElementById('date').value;
      const description = document.getElementById('description').value;

      // Prevent future dates
      const selectedDate = new Date(date);
      const now = new Date();
      now.setHours(0,0,0,0);
      // Allow today also
      if (selectedDate.getTime() > now.getTime() + (24 * 60 * 60 * 1000)) {
        showToast("You can't select a future date!");
        return;
      }

      if (editingIndex !== null) {
        expenses[editingIndex] = { amount, category, date, description };
        editingIndex = null;
        expenseForm.querySelector('button[type="submit"]').textContent = "Add Expense";
        cancelEditBtn.classList.add('hidden');
      } else {
        expenses.push({ amount, category, date, description });
      }
      saveExpenses();
      renderExpenses();
      expenseForm.reset();
      // Reset max date after reset
      dateInput.setAttribute('max', todayStr);
      showToast("Expense saved!", 1500);
    });

    function deleteExpense(index) {
      expenses.splice(index, 1);
      saveExpenses();
      renderExpenses();
    }

    function updateSummary() {
      const now = new Date();
      const totals = { today: 0, week: 0, month: 0, year: 0 };

      expenses.forEach(expense => {
        const expDate = new Date(expense.date);
        if (isSameDay(expDate, now)) totals.today += expense.amount;
        if (isSameWeek(expDate, now)) totals.week += expense.amount;
        if (isSameMonth(expDate, now)) totals.month += expense.amount;
        if (isSameYear(expDate, now)) totals.year += expense.amount;
      });

      todayTotal.textContent = `₹${totals.today}`;
      weekTotal.textContent = `₹${totals.week}`;
      monthTotal.textContent = `₹${totals.month}`;
      yearTotal.textContent = `₹${totals.year}`;
      customTotal.textContent = `₹${totals.month}`;

      // Budget alert
      const alertDiv = document.getElementById('budget-alert');
      if (budget && totals.month > budget) {
        alertDiv.textContent = `⚠️ You have exceeded your monthly budget of ₹${budget}!`;
        alertDiv.classList.remove('hidden');
      } else {
        alertDiv.classList.add('hidden');
      }
    }

    function isSameDay(d1, d2) {
      return d1.getDate() === d2.getDate() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getFullYear() === d2.getFullYear();
    }

    function isSameWeek(d1, d2) {
      const diff = d2 - d1;
      return diff < 7 * 24 * 60 * 60 * 1000 && d1.getDay() <= d2.getDay();
    }

    function isSameMonth(d1, d2) {
      return d1.getMonth() === d2.getMonth() && d1.getFullYear() === d2.getFullYear();
    }

    function isSameYear(d1, d2) {
      return d1.getFullYear() === d2.getFullYear();
    }

    let categoryChart;
    let monthlyChart;

    function updateCharts() {
      const categoryData = {};
      const monthlyData = {};

      expenses.forEach(expense => {
        categoryData[expense.category] = (categoryData[expense.category] || 0) + expense.amount;
        const monthKey = expense.date.slice(0, 7);
        monthlyData[monthKey] = (monthlyData[monthKey] || 0) + expense.amount;
      });

      if (categoryChart) categoryChart.destroy();
      categoryChart = new Chart(document.getElementById('category-chart'), {
        type: 'pie',
        data: {
          labels: Object.keys(categoryData),
          datasets: [{
            data: Object.values(categoryData),
            backgroundColor: ['#60a5fa', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6'],
            hoverOffset: 16
          }]
        },
        options: {
          animation: {
            animateScale: true,
            duration: 1200
          }
        }
      });

      if (monthlyChart) monthlyChart.destroy();
      monthlyChart = new Chart(document.getElementById('monthly-chart'), {
        type: 'bar',
        data: {
          labels: Object.keys(monthlyData),
          datasets: [{
            label: 'Monthly Spending',
            data: Object.values(monthlyData),
            backgroundColor: '#3b82f6'
          }]
        },
        options: {
          animation: {
            duration: 1200,
            easing: 'easeOutBounce'
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function formatDate(dateStr) {
      const d = new Date(dateStr);
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${day}-${month}-${year}`;
    }

    renderExpenses();
  </script>
</body>
</html>